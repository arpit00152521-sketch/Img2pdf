<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Melo Pro - Music Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --secondary: #0ea5e9;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --bg: #0f172a;
            --bg-card: #1e293b;
            --bg-player: rgba(15, 23, 42, 0.95);
            --text: #f8fafc;
            --text-secondary: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --radius: 16px;
            --player-height: 70px;
            --bottom-bar: 60px;
        }

        .theme-light {
            --bg: #f8fafc;
            --bg-card: #ffffff;
            --bg-player: rgba(255, 255, 255, 0.95);
            --text: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }

        .theme-dark {
            --bg: #0f172a;
            --bg-card: #1e293b;
            --bg-player: rgba(15, 23, 42, 0.95);
            --text: #f8fafc;
            --text-secondary: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
        }

        .theme-blue {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --bg: #1e3a8a;
            --bg-card: #1e40af;
            --text: #dbeafe;
            --text-secondary: #93c5fd;
            --border: rgba(59, 130, 246, 0.3);
        }

        .theme-purple {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --bg: #4c1d95;
            --bg-card: #5b21b6;
            --text: #ede9fe;
            --text-secondary: #c4b5fd;
            --border: rgba(139, 92, 246, 0.3);
        }

        .theme-green {
            --primary: #10b981;
            --primary-dark: #059669;
            --bg: #064e3b;
            --bg-card: #065f46;
            --text: #d1fae5;
            --text-secondary: #a7f3d0;
            --border: rgba(16, 185, 129, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
            transition: background-color 0.3s ease;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* App Container */
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }

        /* Status Bar */
        .status-bar {
            height: env(safe-area-inset-top, 0px);
            background: rgba(0, 0, 0, 0.3);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        /* Header */
        .header {
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            height: 56px;
            backdrop-filter: blur(10px);
        }

        .header-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .icon-btn:active {
            transform: scale(0.95);
            background: rgba(124, 58, 237, 0.2);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: calc(var(--player-height) + var(--bottom-bar) + 20px);
            -webkit-overflow-scrolling: touch;
            padding-top: 56px;
        }

        /* Welcome Screen */
        .welcome-screen {
            padding: 32px 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .welcome-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .welcome-logo i {
            font-size: 50px;
            color: white;
        }

        /* Permission Card */
        .permission-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 24px;
            margin-top: 20px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            max-width: 400px;
            width: 100%;
        }

        .permission-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .permission-btn:active {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(124, 58, 237, 0.3);
        }

        /* Library Screen */
        .library-screen {
            display: none;
            height: 100%;
        }

        .library-content {
            padding: 0 16px 20px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            padding: 0 16px 16px;
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: rgba(124, 58, 237, 0.2);
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Songs List */
        .songs-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .song-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .song-item:active {
            transform: scale(0.98);
            background: rgba(124, 58, 237, 0.1);
        }

        .song-item.playing {
            background: rgba(124, 58, 237, 0.2);
            border-color: var(--primary);
        }

        /* Now Playing Screen */
        .now-playing-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 1000;
            display: none;
            flex-direction: column;
            background-size: cover;
            background-position: center;
        }

        .np-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .np-back-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .np-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .np-album-art {
            width: 280px;
            height: 280px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            margin: 20px 0 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 60px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .np-album-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .np-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .np-control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .np-control-btn:active {
            transform: scale(0.95);
            background: rgba(124, 58, 237, 0.2);
        }

        .np-play-btn {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-size: 28px;
        }

        /* Queue Screen */
        .queue-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .queue-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--border);
        }

        .queue-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .queue-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-card);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .queue-item.playing {
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--primary);
        }

        /* Sleep Timer Screen */
        .timer-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .timer-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .timer-display {
            font-size: 48px;
            font-weight: 700;
            margin: 30px 0;
            color: var(--primary);
        }

        .timer-presets {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .timer-preset {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 15px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .timer-preset.active {
            background: rgba(124, 58, 237, 0.3);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Equalizer Screen */
        .equalizer-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .eq-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .eq-sliders {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 10px;
            height: 200px;
            margin: 30px 0;
        }

        .eq-slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .eq-slider {
            width: 30px;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
        }

        .eq-slider-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, var(--primary), var(--secondary));
            border-radius: 15px;
            transition: height 0.3s ease;
        }

        /* Settings Screen */
        .settings-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .settings-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .settings-section {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .settings-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        /* Theme Selector */
        .theme-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .theme-option {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .theme-option.active {
            border-color: var(--text);
            transform: scale(1.1);
        }

        /* Wallpaper Selector */
        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .wallpaper-option {
            width: 100%;
            height: 80px;
            border-radius: 12px;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .wallpaper-option.active {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .wallpaper-option.custom {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            font-size: 24px;
        }

        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Music Player Bar */
        .music-player {
            position: fixed;
            bottom: var(--bottom-bar);
            left: 0;
            right: 0;
            height: var(--player-height);
            background: var(--bg-player);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: none;
            align-items: center;
            padding: 0 16px;
            z-index: 100;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text);
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-btn:active {
            transform: scale(0.95);
            background: rgba(124, 58, 237, 0.2);
        }

        .play-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--bottom-bar);
            background: var(--bg-player);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding-bottom: env(safe-area-inset-bottom, 0px);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            flex: 1;
            padding: 8px;
            transition: all 0.3s ease;
        }

        .nav-item.active {
            color: var(--primary);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 24px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--bg-card);
            border-radius: 12px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow);
            z-index: 2000;
            transition: transform 0.3s ease;
            max-width: 90%;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Empty State */
        .empty-state {
            padding: 60px 20px;
            text-align: center;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (min-width: 768px) {
            .app-container {
                max-width: 768px;
                margin: 0 auto;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Status Bar -->
    <div class="status-bar"></div>

    <div class="app-container">
        <!-- Welcome Screen -->
        <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-logo">
                <i class="fas fa-music"></i>
            </div>
            <h1 class="header-title">Melo Pro</h1>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">Complete Music Player with All Features</p>
            
            <div class="permission-card">
                <button class="permission-btn" id="grantPermissionBtn">
                    <i class="fas fa-check-circle"></i>
                    Start Using Melo Pro
                </button>
                
                <div style="margin-top: 25px;">
                    <h3 style="margin-bottom: 15px; font-size: 16px;">Features:</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
                        <div><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> Working Queue</div>
                        <div><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> Sleep Timer</div>
                        <div><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> Equalizer</div>
                        <div><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> Themes</div>
                        <div><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> Wallpapers</div>
                        <div><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> Dark/Light Mode</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Library Screen -->
        <div class="library-screen" id="libraryScreen">
            <div class="header">
                <h2 class="header-title">Library</h2>
                <div class="header-actions">
                    <button class="icon-btn" id="settingsBtn">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            
            <div class="library-content">
                <div class="tabs" id="tabs">
                    <div class="tab active" data-tab="songs">Songs</div>
                    <div class="tab" data-tab="queue">Queue</div>
                    <div class="tab" data-tab="playlists">Playlists</div>
                </div>
                
                <div class="tab-content" id="tabContent">
                    <!-- Songs will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Now Playing Screen -->
        <div class="now-playing-screen" id="nowPlayingScreen">
            <div class="np-header">
                <button class="np-back-btn" id="npBackBtn">
                    <i class="fas fa-chevron-down"></i>
                </button>
                <h3>Now Playing</h3>
                <button class="icon-btn" id="npMenuBtn">
                    <i class="fas fa-ellipsis-h"></i>
                </button>
            </div>
            
            <div class="np-content">
                <div class="np-album-art" id="npAlbumArt">
                    <i class="fas fa-music"></i>
                </div>
                
                <div class="np-info">
                    <h2 class="np-song-title" id="npSongTitle">No song playing</h2>
                    <p class="np-song-artist" id="npSongArtist">Select a song to play</p>
                    <p class="np-song-album" id="npSongAlbum">-</p>
                </div>
                
                <div class="np-progress">
                    <div class="np-progress-bar" id="npProgressBar">
                        <div class="np-progress-fill" id="npProgressFill"></div>
                    </div>
                    <div class="np-time">
                        <span id="npCurrentTime">0:00</span>
                        <span id="npDuration">0:00</span>
                    </div>
                </div>
                
                <div class="np-controls">
                    <button class="np-control-btn" id="npShuffleBtn" title="Shuffle">
                        <i class="fas fa-random"></i>
                    </button>
                    <button class="np-control-btn" id="npPrevBtn" title="Previous">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="np-control-btn np-play-btn" id="npPlayBtn" title="Play/Pause">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="np-control-btn" id="npNextBtn" title="Next">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="np-control-btn" id="npRepeatBtn" title="Repeat">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
                
                <div class="np-extra-controls">
                    <button class="icon-btn" id="npQueueBtn" title="Queue">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button class="icon-btn" id="npLikeBtn" title="Like">
                        <i class="far fa-heart"></i>
                    </button>
                    <button class="icon-btn" id="npTimerBtn" title="Sleep Timer">
                        <i class="fas fa-clock"></i>
                    </button>
                    <button class="icon-btn" id="npEqualizerBtn" title="Equalizer">
                        <i class="fas fa-sliders-h"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Queue Screen -->
        <div class="queue-screen" id="queueScreen">
            <div class="queue-header">
                <button class="np-back-btn" id="queueBackBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h3>Queue</h3>
                <button class="icon-btn" id="clearQueueBtn">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="queue-content" id="queueContent">
                <!-- Queue items will be loaded here -->
            </div>
        </div>

        <!-- Sleep Timer Screen -->
        <div class="timer-screen" id="timerScreen">
            <div class="queue-header">
                <button class="np-back-btn" id="timerBackBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h3>Sleep Timer</h3>
            </div>
            <div class="timer-container">
                <div class="timer-display" id="timerDisplay">00:00</div>
                <div class="timer-presets">
                    <div class="timer-preset" data-minutes="5">5 min</div>
                    <div class="timer-preset" data-minutes="10">10 min</div>
                    <div class="timer-preset" data-minutes="15">15 min</div>
                    <div class="timer-preset" data-minutes="30">30 min</div>
                    <div class="timer-preset" data-minutes="45">45 min</div>
                    <div class="timer-preset" data-minutes="60">60 min</div>
                </div>
                <div style="display: flex; gap: 20px; margin-top: 30px;">
                    <button class="permission-btn" id="startTimerBtn" style="width: auto; padding: 12px 30px;">
                        Start Timer
                    </button>
                    <button class="permission-btn" id="cancelTimerBtn" style="width: auto; padding: 12px 30px; background: var(--danger); display: none;">
                        Cancel Timer
                    </button>
                </div>
            </div>
        </div>

        <!-- Equalizer Screen -->
        <div class="equalizer-screen" id="equalizerScreen">
            <div class="queue-header">
                <button class="np-back-btn" id="eqBackBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h3>Equalizer</h3>
                <button class="icon-btn" id="resetEqBtn">
                    <i class="fas fa-undo"></i>
                </button>
            </div>
            <div class="eq-container">
                <div style="margin-bottom: 30px; text-align: center;">
                    <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center;">
                        <button class="timer-preset" data-preset="flat">Flat</button>
                        <button class="timer-preset" data-preset="pop">Pop</button>
                        <button class="timer-preset" data-preset="rock">Rock</button>
                        <button class="timer-preset" data-preset="jazz">Jazz</button>
                        <button class="timer-preset" data-preset="classical">Classical</button>
                    </div>
                </div>
                
                <div class="eq-sliders" id="eqSliders">
                    <!-- EQ sliders will be loaded here -->
                </div>
                
                <div style="margin-top: 30px; display: flex; gap: 20px;">
                    <button class="icon-btn" id="eqToggleBtn">
                        <i class="fas fa-power-off"></i>
                    </button>
                    <div style="color: var(--text-secondary); font-size: 14px;">
                        Equalizer: <span id="eqStatus">Off</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div class="settings-screen" id="settingsScreen">
            <div class="queue-header">
                <button class="np-back-btn" id="settingsBackBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h3>Settings</h3>
            </div>
            <div class="settings-content">
                <!-- Theme Settings -->
                <div class="settings-section">
                    <h4 class="settings-title">Appearance</h4>
                    
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Dark/Light Mode</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Switch between dark and light themes</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Theme Color</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Choose app theme color</div>
                        </div>
                    </div>
                    
                    <div class="theme-selector">
                        <div class="theme-option active" data-theme="default" style="background: linear-gradient(135deg, #7c3aed, #0ea5e9);"></div>
                        <div class="theme-option" data-theme="blue" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);"></div>
                        <div class="theme-option" data-theme="purple" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);"></div>
                        <div class="theme-option" data-theme="green" style="background: linear-gradient(135deg, #10b981, #34d399);"></div>
                    </div>
                </div>
                
                <!-- Background Settings -->
                <div class="settings-section">
                    <h4 class="settings-title">Background</h4>
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Background Image</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Change app background</div>
                        </div>
                    </div>
                    
                    <div class="wallpaper-grid">
                        <div class="wallpaper-option active" data-wallpaper="none" style="background: var(--bg);">
                            <i class="fas fa-ban" style="color: var(--text-secondary);"></i>
                        </div>
                        <div class="wallpaper-option" data-wallpaper="gradient1" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                        <div class="wallpaper-option" data-wallpaper="gradient2" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                        <div class="wallpaper-option" data-wallpaper="gradient3" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                        <div class="wallpaper-option" data-wallpaper="gradient4" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                        <div class="wallpaper-option custom" data-wallpaper="custom" style="background: rgba(255, 255, 255, 0.1);">
                            <i class="fas fa-image"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Blur Intensity</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Adjust background blur</div>
                        </div>
                        <input type="range" id="blurSlider" min="0" max="20" value="5" style="width: 100px;">
                    </div>
                </div>
                
                <!-- Audio Settings -->
                <div class="settings-section">
                    <h4 class="settings-title">Audio</h4>
                    
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Crossfade</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Smooth transition between songs</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="crossfadeValue">0s</span>
                            <input type="range" id="crossfadeSlider" min="0" max="10" value="0" style="width: 80px;">
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Gapless Playback</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Remove gaps between tracks</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="gaplessToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Volume Boost</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Increase maximum volume</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="volumeBoostToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- Storage Settings -->
                <div class="settings-section">
                    <h4 class="settings-title">Storage</h4>
                    
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Scan for Music</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Rescan device for music files</div>
                        </div>
                        <button class="icon-btn" id="rescanBtn" style="width: auto; padding: 8px 16px; font-size: 14px;">
                            <i class="fas fa-redo"></i> Scan
                        </button>
                    </div>
                    
                    <div class="settings-item">
                        <div>
                            <div style="font-weight: 500;">Clear Cache</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Clear temporary files</div>
                        </div>
                        <button class="icon-btn" id="clearCacheBtn" style="width: auto; padding: 8px 16px; font-size: 14px; background: var(--danger);">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Music Player Bar -->
        <div class="music-player" id="musicPlayer">
            <div class="player-album" id="playerAlbum">
                <i class="fas fa-music"></i>
            </div>
            <div class="player-info">
                <div class="player-song-name" id="playerSongName">No song playing</div>
                <div class="player-song-artist" id="playerSongArtist">Select a song to play</div>
            </div>
            <div class="player-controls">
                <button class="player-btn" id="playerPrevBtn">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="player-btn play-btn" id="playerPlayBtn">
                    <i class="fas fa-play"></i>
                </button>
                <button class="player-btn" id="playerNextBtn">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active" data-page="library">
                <i class="fas fa-home nav-icon"></i>
                <span>Library</span>
            </a>
            <a href="#" class="nav-item" data-page="now-playing">
                <i class="fas fa-play-circle nav-icon"></i>
                <span>Now Playing</span>
            </a>
            <a href="#" class="nav-item" data-page="queue">
                <i class="fas fa-list-ol nav-icon"></i>
                <span>Queue</span>
            </a>
            <a href="#" class="nav-item" data-page="settings">
                <i class="fas fa-cog nav-icon"></i>
                <span>Settings</span>
            </a>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast">
            <i class="fas fa-check-circle toast-icon"></i>
            <div class="toast-message" id="toastMessage">Success!</div>
        </div>
    </div>

    <script>
        // Complete App State
        const appState = {
            // Music Data
            songs: [
                {
                    id: 1,
                    name: "Blinding Lights",
                    artist: "The Weeknd",
                    album: "After Hours",
                    duration: "3:22",
                    color: "#ef4444",
                    liked: true
                },
                {
                    id: 2,
                    name: "Levitating",
                    artist: "Dua Lipa",
                    album: "Future Nostalgia",
                    duration: "3:24",
                    color: "#8b5cf6",
                    liked: false
                },
                {
                    id: 3,
                    name: "Stay",
                    artist: "The Kid LAROI, Justin Bieber",
                    album: "F*CK LOVE 3",
                    duration: "2:21",
                    color: "#0ea5e9",
                    liked: true
                },
                {
                    id: 4,
                    name: "Good 4 U",
                    artist: "Olivia Rodrigo",
                    album: "SOUR",
                    duration: "2:58",
                    color: "#10b981",
                    liked: false
                },
                {
                    id: 5,
                    name: "Heat Waves",
                    artist: "Glass Animals",
                    album: "Dreamland",
                    duration: "3:59",
                    color: "#f59e0b",
                    liked: true
                }
            ],
            queue: [],
            currentSongIndex: -1,
            isPlaying: false,
            audioPlayer: new Audio(),
            
            // Playback Settings
            volume: 0.7,
            repeatMode: 'none', // none, one, all
            shuffleMode: false,
            
            // Equalizer Settings
            equalizer: {
                enabled: false,
                preset: 'flat',
                gains: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            },
            
            // Sleep Timer
            sleepTimer: {
                active: false,
                endTime: null,
                duration: 0,
                timerId: null
            },
            
            // App Settings
            settings: {
                theme: 'default',
                darkMode: true,
                wallpaper: 'none',
                blurIntensity: 5,
                crossfade: 0,
                gapless: true,
                volumeBoost: false
            },
            
            // UI State
            currentScreen: 'welcome',
            currentTab: 'songs'
        };

        // DOM Elements
        const welcomeScreen = document.getElementById('welcomeScreen');
        const libraryScreen = document.getElementById('libraryScreen');
        const nowPlayingScreen = document.getElementById('nowPlayingScreen');
        const queueScreen = document.getElementById('queueScreen');
        const timerScreen = document.getElementById('timerScreen');
        const equalizerScreen = document.getElementById('equalizerScreen');
        const settingsScreen = document.getElementById('settingsScreen');
        const musicPlayer = document.getElementById('musicPlayer');
        const toast = document.getElementById('toast');

        // Initialize App
        function initApp() {
            loadSettings();
            setupEventListeners();
            setupAudioPlayer();
            initializeQueue();
            initializeEqualizer();
            updateUI();
            
            // Show welcome screen
            showScreen('welcome');
        }

        // Load Settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('meloProSettings');
            if (saved) {
                const parsed = JSON.parse(saved);
                Object.assign(appState.settings, parsed);
                
                // Apply settings
                applyTheme(appState.settings.theme);
                applyDarkMode(appState.settings.darkMode);
                applyWallpaper(appState.settings.wallpaper);
                applyBlur(appState.settings.blurIntensity);
            }
        }

        // Save Settings to localStorage
        function saveSettings() {
            localStorage.setItem('meloProSettings', JSON.stringify(appState.settings));
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Navigation
            document.getElementById('grantPermissionBtn').addEventListener('click', () => {
                showScreen('library');
            });
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.dataset.page;
                    
                    // Update active nav
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Handle different pages
                    if (page === 'now-playing' && appState.currentSongIndex !== -1) {
                        showScreen('now-playing');
                    } else if (page === 'queue') {
                        showScreen('queue');
                    } else if (page === 'settings') {
                        showScreen('settings');
                    } else {
                        showScreen('library');
                    }
                });
            });
            
            // Back buttons
            document.getElementById('npBackBtn').addEventListener('click', () => showScreen('library'));
            document.getElementById('queueBackBtn').addEventListener('click', () => showScreen('library'));
            document.getElementById('timerBackBtn').addEventListener('click', () => showScreen('now-playing'));
            document.getElementById('eqBackBtn').addEventListener('click', () => showScreen('now-playing'));
            document.getElementById('settingsBackBtn').addEventListener('click', () => showScreen('library'));
            
            // Settings button
            document.getElementById('settingsBtn').addEventListener('click', () => showScreen('settings'));
            
            // Player controls
            setupPlayerControls();
            
            // Queue controls
            document.getElementById('clearQueueBtn').addEventListener('click', clearQueue);
            
            // Timer controls
            setupTimerControls();
            
            // Equalizer controls
            setupEqualizerControls();
            
            // Settings controls
            setupSettingsControls();
            
            // Now Playing controls
            document.getElementById('npQueueBtn').addEventListener('click', () => showScreen('queue'));
            document.getElementById('npTimerBtn').addEventListener('click', () => showScreen('timer'));
            document.getElementById('npEqualizerBtn').addEventListener('click', () => showScreen('equalizer'));
            document.getElementById('npLikeBtn').addEventListener('click', toggleLike);
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    switchTab(tabName);
                });
            });
        }

        // Setup Player Controls
        function setupPlayerControls() {
            const playBtns = ['playerPlayBtn', 'npPlayBtn'];
            const prevBtns = ['playerPrevBtn', 'npPrevBtn'];
            const nextBtns = ['playerNextBtn', 'npNextBtn'];
            
            playBtns.forEach(id => {
                document.getElementById(id).addEventListener('click', togglePlayPause);
            });
            
            prevBtns.forEach(id => {
                document.getElementById(id).addEventListener('click', playPrevious);
            });
            
            nextBtns.forEach(id => {
                document.getElementById(id).addEventListener('click', playNext);
            });
            
            // Shuffle button
            document.getElementById('npShuffleBtn').addEventListener('click', toggleShuffle);
            
            // Repeat button
            document.getElementById('npRepeatBtn').addEventListener('click', toggleRepeat);
            
            // Progress bar
            document.getElementById('npProgressBar').addEventListener('click', seekAudio);
        }

        // Setup Timer Controls
        function setupTimerControls() {
            // Timer presets
            document.querySelectorAll('.timer-preset').forEach(preset => {
                preset.addEventListener('click', function() {
                    if (this.closest('#timerScreen')) {
                        const minutes = parseInt(this.dataset.minutes);
                        setTimer(minutes);
                    }
                });
            });
            
            // Timer buttons
            document.getElementById('startTimerBtn').addEventListener('click', startTimer);
            document.getElementById('cancelTimerBtn').addEventListener('click', cancelTimer);
        }

        // Setup Equalizer Controls
        function setupEqualizerControls() {
            // EQ toggle
            document.getElementById('eqToggleBtn').addEventListener('click', toggleEqualizer);
            
            // Reset EQ
            document.getElementById('resetEqBtn').addEventListener('click', resetEqualizer);
            
            // Presets
            document.querySelectorAll('.timer-preset[data-preset]').forEach(preset => {
                preset.addEventListener('click', function() {
                    const presetName = this.dataset.preset;
                    loadEQPreset(presetName);
                });
            });
        }

        // Setup Settings Controls
        function setupSettingsControls() {
            // Dark mode toggle
            document.getElementById('darkModeToggle').addEventListener('change', function() {
                appState.settings.darkMode = this.checked;
                applyDarkMode(this.checked);
                saveSettings();
            });
            
            // Theme selection
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    applyTheme(theme);
                    appState.settings.theme = theme;
                    saveSettings();
                });
            });
            
            // Wallpaper selection
            document.querySelectorAll('.wallpaper-option').forEach(option => {
                option.addEventListener('click', function() {
                    const wallpaper = this.dataset.wallpaper;
                    if (wallpaper === 'custom') {
                        selectCustomWallpaper();
                    } else {
                        applyWallpaper(wallpaper);
                        appState.settings.wallpaper = wallpaper;
                        saveSettings();
                    }
                });
            });
            
            // Blur slider
            document.getElementById('blurSlider').addEventListener('input', function() {
                const value = parseInt(this.value);
                applyBlur(value);
                appState.settings.blurIntensity = value;
                saveSettings();
            });
            
            // Crossfade slider
            document.getElementById('crossfadeSlider').addEventListener('input', function() {
                const value = parseInt(this.value);
                document.getElementById('crossfadeValue').textContent = value + 's';
                appState.settings.crossfade = value;
                saveSettings();
            });
            
            // Gapless toggle
            document.getElementById('gaplessToggle').addEventListener('change', function() {
                appState.settings.gapless = this.checked;
                saveSettings();
            });
            
            // Volume boost toggle
            document.getElementById('volumeBoostToggle').addEventListener('change', function() {
                appState.settings.volumeBoost = this.checked;
                if (this.checked) {
                    appState.audioPlayer.volume = Math.min(1, appState.volume * 1.3);
                } else {
                    appState.audioPlayer.volume = appState.volume;
                }
                saveSettings();
            });
            
            // Rescan button
            document.getElementById('rescanBtn').addEventListener('click', rescanMusic);
            
            // Clear cache button
            document.getElementById('clearCacheBtn').addEventListener('click', clearCache);
        }

        // Setup Audio Player
        function setupAudioPlayer() {
            const audio = appState.audioPlayer;
            audio.volume = appState.volume;
            
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('loadedmetadata', updateSongInfo);
            audio.addEventListener('ended', handleSongEnd);
            audio.addEventListener('error', handleAudioError);
            
            // Simulate audio for demo
            audio.src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
        }

        // Show Screen
        function showScreen(screen) {
            // Hide all screens
            const screens = ['welcome', 'library', 'now-playing', 'queue', 'timer', 'equalizer', 'settings'];
            screens.forEach(s => {
                const element = document.getElementById(s + 'Screen');
                if (element) element.style.display = 'none';
            });
            
            // Show requested screen
            const screenElement = document.getElementById(screen + 'Screen');
            if (screenElement) {
                screenElement.style.display = 'flex';
                appState.currentScreen = screen;
                
                // Update UI for specific screens
                if (screen === 'library') {
                    renderLibrary();
                } else if (screen === 'queue') {
                    renderQueue();
                } else if (screen === 'timer') {
                    updateTimerDisplay();
                } else if (screen === 'equalizer') {
                    renderEqualizer();
                } else if (screen === 'settings') {
                    loadSettingsUI();
                }
            }
        }

        // Render Library
        function renderLibrary() {
            const tabContent = document.getElementById('tabContent');
            
            if (appState.currentTab === 'songs') {
                let html = '<div class="songs-list">';
                
                appState.songs.forEach((song, index) => {
                    const isPlaying = index === appState.currentSongIndex;
                    html += `
                        <div class="song-item ${isPlaying ? 'playing' : ''}" data-index="${index}">
                            <div class="song-art" style="background: linear-gradient(135deg, ${song.color}, ${adjustColor(song.color, -30)})">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="song-info">
                                <div class="song-name">${song.name}</div>
                                <div class="song-artist">${song.artist}</div>
                            </div>
                            <div class="song-duration">${song.duration}</div>
                            <div class="song-menu" onclick="toggleSongLike(${index})">
                                <i class="${song.liked ? 'fas' : 'far'} fa-heart" style="color: ${song.liked ? 'var(--danger)' : ''}"></i>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                tabContent.innerHTML = html;
                
                // Add click listeners
                document.querySelectorAll('.song-item').forEach((item, index) => {
                    item.addEventListener('click', () => playSong(index));
                });
            } else if (appState.currentTab === 'queue') {
                renderQueueContent();
            }
        }

        // Initialize Queue
        function initializeQueue() {
            // Start with all songs in queue
            appState.queue = [...appState.songs];
        }

        // Render Queue
        function renderQueue() {
            renderQueueContent();
        }

        // Render Queue Content
        function renderQueueContent() {
            const queueContent = document.getElementById('queueContent');
            let html = '<div class="songs-list">';
            
            appState.queue.forEach((song, index) => {
                const isPlaying = appState.currentSongIndex === index;
                html += `
                    <div class="queue-item ${isPlaying ? 'playing' : ''}" data-index="${index}">
                        <div class="song-art" style="background: linear-gradient(135deg, ${song.color}, ${adjustColor(song.color, -30)})">
                            <i class="fas fa-music"></i>
                        </div>
                        <div class="song-info">
                            <div class="song-name">${song.name}</div>
                            <div class="song-artist">${song.artist}</div>
                        </div>
                        <div class="song-duration">${song.duration}</div>
                        <div class="song-menu" onclick="removeFromQueue(${index})">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            queueContent.innerHTML = html;
            
            // Add click listeners
            document.querySelectorAll('.queue-item').forEach((item, index) => {
                item.addEventListener('click', () => playSongFromQueue(index));
            });
        }

        // Clear Queue
        function clearQueue() {
            appState.queue = [];
            renderQueueContent();
            showToast('Queue cleared');
        }

        // Remove from Queue
        function removeFromQueue(index) {
            event.stopPropagation();
            appState.queue.splice(index, 1);
            renderQueueContent();
            showToast('Removed from queue');
        }

        // Play Song
        function playSong(index) {
            if (index < 0 || index >= appState.songs.length) return;
            
            appState.currentSongIndex = index;
            const song = appState.songs[index];
            
            // Update UI
            updatePlayerUI(song);
            updateNowPlayingUI(song);
            
            // Play audio
            appState.audioPlayer.play();
            appState.isPlaying = true;
            updatePlayButtons();
            
            // Show player bar
            musicPlayer.style.display = 'flex';
            
            // Update like button
            updateLikeButton();
            
            // Show now playing if on library
            if (appState.currentScreen === 'library') {
                showScreen('now-playing');
            }
        }

        // Play Song from Queue
        function playSongFromQueue(index) {
            if (index < 0 || index >= appState.queue.length) return;
            
            const song = appState.queue[index];
            // Find song in main list
            const mainIndex = appState.songs.findIndex(s => s.id === song.id);
            if (mainIndex !== -1) {
                playSong(mainIndex);
            }
        }

        // Toggle Play/Pause
        function togglePlayPause() {
            if (appState.currentSongIndex === -1) {
                if (appState.songs.length > 0) {
                    playSong(0);
                }
                return;
            }
            
            if (appState.isPlaying) {
                appState.audioPlayer.pause();
                appState.isPlaying = false;
            } else {
                appState.audioPlayer.play();
                appState.isPlaying = true;
            }
            
            updatePlayButtons();
        }

        // Play Previous
        function playPrevious() {
            if (appState.songs.length === 0) return;
            
            if (appState.shuffleMode) {
                // Play random song
                const randomIndex = Math.floor(Math.random() * appState.songs.length);
                playSong(randomIndex);
            } else {
                let newIndex = appState.currentSongIndex - 1;
                if (newIndex < 0) newIndex = appState.songs.length - 1;
                playSong(newIndex);
            }
        }

        // Play Next
        function playNext() {
            if (appState.songs.length === 0) return;
            
            if (appState.repeatMode === 'one') {
                appState.audioPlayer.currentTime = 0;
                appState.audioPlayer.play();
                return;
            }
            
            if (appState.shuffleMode) {
                // Play random song
                const randomIndex = Math.floor(Math.random() * appState.songs.length);
                playSong(randomIndex);
            } else {
                let newIndex = appState.currentSongIndex + 1;
                if (newIndex >= appState.songs.length) {
                    if (appState.repeatMode === 'all') {
                        newIndex = 0;
                    } else {
                        return;
                    }
                }
                playSong(newIndex);
            }
        }

        // Update Progress
        function updateProgress() {
            const currentTime = appState.audioPlayer.currentTime;
            const duration = appState.audioPlayer.duration;
            
            if (duration) {
                const progressPercent = (currentTime / duration) * 100;
                document.getElementById('npProgressFill').style.width = `${progressPercent}%`;
                
                document.getElementById('npCurrentTime').textContent = formatTime(currentTime);
            }
        }

        // Update Song Info
        function updateSongInfo() {
            const duration = appState.audioPlayer.duration;
            document.getElementById('npDuration').textContent = formatTime(duration);
        }

        // Handle Song End
        function handleSongEnd() {
            if (appState.repeatMode === 'one') {
                appState.audioPlayer.currentTime = 0;
                appState.audioPlayer.play();
            } else {
                playNext();
            }
        }

        // Seek Audio
        function seekAudio(e) {
            const progressBar = e.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const width = rect.width;
            const percentage = clickX / width;
            
            appState.audioPlayer.currentTime = percentage * appState.audioPlayer.duration;
        }

        // Toggle Shuffle
        function toggleShuffle() {
            appState.shuffleMode = !appState.shuffleMode;
            const btn = document.getElementById('npShuffleBtn');
            
            if (appState.shuffleMode) {
                btn.style.color = 'var(--primary)';
                showToast('Shuffle on');
            } else {
                btn.style.color = '';
                showToast('Shuffle off');
            }
        }

        // Toggle Repeat
        function toggleRepeat() {
            const modes = ['none', 'one', 'all'];
            const currentIndex = modes.indexOf(appState.repeatMode);
            appState.repeatMode = modes[(currentIndex + 1) % modes.length];
            
            const btn = document.getElementById('npRepeatBtn');
            const colors = ['', 'var(--primary)', 'var(--secondary)'];
            btn.style.color = colors[(currentIndex + 1) % modes.length];
            
            const messages = ['Repeat off', 'Repeat one', 'Repeat all'];
            showToast(messages[(currentIndex + 1) % modes.length]);
        }

        // Toggle Like
        function toggleLike() {
            if (appState.currentSongIndex === -1) return;
            
            const song = appState.songs[appState.currentSongIndex];
            song.liked = !song.liked;
            
            updateLikeButton();
            showToast(song.liked ? 'Added to favorites' : 'Removed from favorites');
        }

        // Toggle Song Like from Library
        function toggleSongLike(index) {
            event.stopPropagation();
            const song = appState.songs[index];
            song.liked = !song.liked;
            
            // Update UI
            renderLibrary();
            if (index === appState.currentSongIndex) {
                updateLikeButton();
            }
            
            showToast(song.liked ? 'Added to favorites' : 'Removed from favorites');
        }

        // Update Player UI
        function updatePlayerUI(song) {
            document.getElementById('playerSongName').textContent = song.name;
            document.getElementById('playerSongArtist').textContent = song.artist;
            document.getElementById('playerAlbum').style.background = `linear-gradient(135deg, ${song.color}, ${adjustColor(song.color, -30)})`;
        }

        // Update Now Playing UI
        function updateNowPlayingUI(song) {
            document.getElementById('npSongTitle').textContent = song.name;
            document.getElementById('npSongArtist').textContent = song.artist;
            document.getElementById('npSongAlbum').textContent = song.album;
            document.getElementById('npAlbumArt').style.background = `linear-gradient(135deg, ${song.color}, ${adjustColor(song.color, -30)})`;
        }

        // Update Like Button
        function updateLikeButton() {
            if (appState.currentSongIndex === -1) return;
            
            const song = appState.songs[appState.currentSongIndex];
            const isLiked = song.liked;
            
            const icon = isLiked ? 'fas fa-heart' : 'far fa-heart';
            const color = isLiked ? 'var(--danger)' : '';
            
            document.getElementById('npLikeBtn').innerHTML = `<i class="${icon}"></i>`;
            document.getElementById('npLikeBtn').style.color = color;
        }

        // Update Play Buttons
        function updatePlayButtons() {
            const icon = appState.isPlaying ? 'fas fa-pause' : 'fas fa-play';
            document.getElementById('playerPlayBtn').innerHTML = `<i class="${icon}"></i>`;
            document.getElementById('npPlayBtn').innerHTML = `<i class="${icon}"></i>`;
        }

        // Switch Tab
        function switchTab(tabName) {
            appState.currentTab = tabName;
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // Render content
            renderLibrary();
        }

        // Sleep Timer Functions
        function setTimer(minutes) {
            appState.sleepTimer.duration = minutes * 60;
            updateTimerDisplay();
            
            // Update active preset
            document.querySelectorAll('.timer-preset').forEach(p => p.classList.remove('active'));
            document.querySelector(`.timer-preset[data-minutes="${minutes}"]`).classList.add('active');
        }

        function startTimer() {
            if (appState.sleepTimer.duration === 0) {
                showToast('Please select a duration', 'warning');
                return;
            }
            
            appState.sleepTimer.active = true;
            appState.sleepTimer.endTime = Date.now() + (appState.sleepTimer.duration * 1000);
            
            // Update UI
            document.getElementById('startTimerBtn').style.display = 'none';
            document.getElementById('cancelTimerBtn').style.display = 'block';
            
            // Start countdown
            appState.sleepTimer.timerId = setInterval(updateTimer, 1000);
            
            showToast(`Sleep timer set for ${appState.sleepTimer.duration / 60} minutes`);
        }

        function cancelTimer() {
            appState.sleepTimer.active = false;
            clearInterval(appState.sleepTimer.timerId);
            
            // Update UI
            document.getElementById('startTimerBtn').style.display = 'block';
            document.getElementById('cancelTimerBtn').style.display = 'none';
            
            showToast('Sleep timer cancelled');
        }

        function updateTimer() {
            if (!appState.sleepTimer.active) return;
            
            const remaining = Math.max(0, Math.floor((appState.sleepTimer.endTime - Date.now()) / 1000));
            
            if (remaining === 0) {
                // Timer ended
                appState.audioPlayer.pause();
                cancelTimer();
                showToast('Sleep timer ended playback');
            }
            
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            let seconds = appState.sleepTimer.duration;
            
            if (appState.sleepTimer.active && appState.sleepTimer.endTime) {
                seconds = Math.max(0, Math.floor((appState.sleepTimer.endTime - Date.now()) / 1000));
            }
            
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('timerDisplay').textContent = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Equalizer Functions
        function initializeEqualizer() {
            const frequencies = ['60', '150', '400', '1K', '2.4K', '6K', '15K'];
            
            // Set default preset
            loadEQPreset('flat');
        }

        function renderEqualizer() {
            const eqSliders = document.getElementById('eqSliders');
            eqSliders.innerHTML = '';
            
            const frequencies = ['60', '150', '400', '1K', '2.4K', '6K', '15K'];
            
            frequencies.forEach((freq, index) => {
                const gain = appState.equalizer.gains[index] || 0;
                
                const sliderContainer = document.createElement('div');
                sliderContainer.className = 'eq-slider-container';
                sliderContainer.innerHTML = `
                    <div class="eq-slider" data-index="${index}">
                        <div class="eq-slider-fill" style="height: ${50 + gain * 5}%"></div>
                    </div>
                    <div class="eq-frequency">${freq}</div>
                `;
                
                // Add click event
                const slider = sliderContainer.querySelector('.eq-slider');
                slider.addEventListener('click', (e) => {
                    const rect = slider.getBoundingClientRect();
                    const clickY = e.clientY - rect.top;
                    const height = rect.height;
                    const gain = ((height - clickY) / height) * 20 - 10;
                    
                    appState.equalizer.gains[index] = Math.max(-10, Math.min(10, gain));
                    slider.querySelector('.eq-slider-fill').style.height = `${50 + appState.equalizer.gains[index] * 5}%`;
                    
                    // Change preset to custom
                    appState.equalizer.preset = 'custom';
                });
                
                eqSliders.appendChild(sliderContainer);
            });
            
            // Update status
            document.getElementById('eqStatus').textContent = appState.equalizer.enabled ? 'On' : 'Off';
            document.getElementById('eqToggleBtn').style.color = appState.equalizer.enabled ? 'var(--success)' : '';
        }

        function toggleEqualizer() {
            appState.equalizer.enabled = !appState.equalizer.enabled;
            
            document.getElementById('eqStatus').textContent = appState.equalizer.enabled ? 'On' : 'Off';
            document.getElementById('eqToggleBtn').style.color = appState.equalizer.enabled ? 'var(--success)' : '';
            
            showToast(`Equalizer ${appState.equalizer.enabled ? 'enabled' : 'disabled'}`);
        }

        function loadEQPreset(preset) {
            const presets = {
                flat: [0, 0, 0, 0, 0, 0, 0],
                pop: [2, 1, 0, -1, 0, 1, 3],
                rock: [4, 3, 2, 1, 0, 0, 1],
                jazz: [0, 0, 1, 2, 3, 2, 1],
                classical: [-1, 0, 1, 2, 3, 3, 2]
            };
            
            appState.equalizer.preset = preset;
            appState.equalizer.gains = presets[preset] || presets.flat;
            
            // Update UI
            renderEqualizer();
            showToast(`${preset.charAt(0).toUpperCase() + preset.slice(1)} preset applied`);
        }

        function resetEqualizer() {
            loadEQPreset('flat');
        }

        // Settings Functions
        function loadSettingsUI() {
            // Set current values
            document.getElementById('darkModeToggle').checked = appState.settings.darkMode;
            document.getElementById('crossfadeSlider').value = appState.settings.crossfade;
            document.getElementById('crossfadeValue').textContent = appState.settings.crossfade + 's';
            document.getElementById('gaplessToggle').checked = appState.settings.gapless;
            document.getElementById('volumeBoostToggle').checked = appState.settings.volumeBoost;
            document.getElementById('blurSlider').value = appState.settings.blurIntensity;
            
            // Set active theme
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.toggle('active', option.dataset.theme === appState.settings.theme);
            });
            
            // Set active wallpaper
            document.querySelectorAll('.wallpaper-option').forEach(option => {
                option.classList.toggle('active', option.dataset.wallpaper === appState.settings.wallpaper);
            });
        }

        function applyTheme(theme) {
            // Remove all theme classes
            document.body.classList.remove('theme-light', 'theme-dark', 'theme-blue', 'theme-purple', 'theme-green');
            
            // Add selected theme class
            if (theme !== 'default') {
                document.body.classList.add('theme-' + theme);
            }
            
            // Update active theme UI
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.toggle('active', option.dataset.theme === theme);
            });
        }

        function applyDarkMode(enabled) {
            if (enabled) {
                document.body.classList.remove('theme-light');
                if (!document.body.classList.contains('theme-dark') && !appState.settings.theme.includes('theme-')) {
                    document.body.classList.add('theme-dark');
                }
            } else {
                document.body.classList.remove('theme-dark');
                document.body.classList.add('theme-light');
            }
        }

        function applyWallpaper(wallpaper) {
            const wallpapers = {
                none: '',
                gradient1: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                gradient2: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                gradient3: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                gradient4: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
            };
            
            if (wallpaper === 'none') {
                document.body.style.backgroundImage = '';
            } else if (wallpapers[wallpaper]) {
                document.body.style.backgroundImage = wallpapers[wallpaper];
            }
            
            // Update active wallpaper UI
            document.querySelectorAll('.wallpaper-option').forEach(option => {
                option.classList.toggle('active', option.dataset.wallpaper === wallpaper);
            });
        }

        function applyBlur(intensity) {
            document.querySelector('.app-container').style.backdropFilter = `blur(${intensity}px)`;
        }

        function selectCustomWallpaper() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.style.display = 'none';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        document.body.style.backgroundImage = `url(${event.target.result})`;
                        appState.settings.wallpaper = 'custom';
                        saveSettings();
                        showToast('Custom wallpaper applied');
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }

        function rescanMusic() {
            showToast('Scanning for music...');
            // Simulate scanning
            setTimeout(() => {
                showToast('Music library updated');
            }, 1500);
        }

        function clearCache() {
            showToast('Cache cleared');
        }

        // Utility Functions
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function adjustColor(color, amount) {
            return color; // Simplified
        }

        function showToast(message, type = 'success') {
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            
            // Set icon based on type
            const icon = toast.querySelector('.toast-icon');
            if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle toast-icon';
                icon.style.color = 'var(--danger)';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-triangle toast-icon';
                icon.style.color = 'var(--warning)';
            } else {
                icon.className = 'fas fa-check-circle toast-icon';
                icon.style.color = 'var(--success)';
            }
            
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function updateUI() {
            // Apply current settings
            applyTheme(appState.settings.theme);
            applyDarkMode(appState.settings.darkMode);
            applyWallpaper(appState.settings.wallpaper);
            applyBlur(appState.settings.blurIntensity);
        }

        function handleAudioError(error) {
            console.error('Audio error:', error);
            showToast('Error playing audio', 'error');
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
    </html>
